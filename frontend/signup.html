<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Sign up • Car Rental</title>

  <!-- Bootstrap (matching index.html) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
        crossorigin="anonymous">

  <!-- Global site styles -->
  <link rel="stylesheet" href="homepage.css" />
  <link rel="stylesheet" href="contribute.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        integrity="sha512-MhF3L6W4rqSzp8n7eSlsM4kqNbb1zEhGyVxPfoF/x4k+VvZq0N8JYB6gC8mf+H4HPpaeQbRucDMkGmraTz1Yfg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"/>

  <!-- Icons + Theme -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <script type="text/javascript" src="./darkmode.js" defer></script>

  <style>
    .msg { margin-top:14px; padding:12px 14px; border-radius:10px; font-weight:500; }
    .msg.info { background:#e8f2ff; color:#0b3a82; }
    .msg.success { background:#e8ffef; color:#0d6b2f; }
    .msg.error { background:#ffefef; color:#7a1320; }
    .btn-secondary { display:inline-block; margin-top:10px; padding:10px 14px; border-radius:10px; border:1px solid #999; text-decoration:none; }
  </style>
</head>

<body>
  <header>
    <nav class="navbar">
      <img src="../assets/logo.png" alt="Cruzr" class="nav-logo">
      <nav class="nav">
        <button id="theme-switch">
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Zm0-80q88 0 158-48.5T740-375q-20 5-40 8t-40 3q-123 0-209.5-86.5T364-660q0-20 3-40t8-40q-78 32-126.5 102T200-480q0 116 82 198t198 82Zm-10-270Z"/></svg>
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M480-360q50 0 85-35t35-85q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 50 35 85t85 35Zm0 80q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480q0 83-58.5 141.5T480-280ZM200-440H40v-80h160v80Zm720 0H760v-80h160v80ZM440-760v-160h80v160h-80Zm0 720v-160h80v160h-80ZM256-650l-101-97 57-59 96 100-52 56Zm492 496-97-101 53-55 101 97-57 59Zm-98-550 97-101 59 57-100 96-56-52ZM154-212l101-97 55 53-97 101-59-57Zm326-268Z"/></svg>
        </button>

        <a class="nav-link" href="index.html">Home</a>
        <a class="nav-link" href="./booking.html">Booking</a>
        <a class="nav-link" href="help.html">Help</a>
        <a class="nav-link" href="contribute.html" id="devs">Contribute</a>
      </nav>
    </nav>
  </header>

  <section class="hero" style="padding-top:3rem">
    <div class="wrap" style="max-width:420px">
      <h1 class="title" style="font-size:2rem">Create your account</h1>

      <form id="signup-form" style="margin-top:1rem">
        <input id="name" placeholder="Full name" style="width:100%;padding:12px;border-radius:10px;margin:6px 0" />
        <input id="email" type="email" placeholder="Email" required style="width:100%;padding:12px;border-radius:10px;margin:6px 0" />
        <input id="password" type="password" placeholder="Password" required style="width:100%;padding:12px;border-radius:10px;margin:6px 0" />
        <button class="submit-btn" style="width:100%;padding:12px;border-radius:10px;margin-top:10px">Create account</button>
      </form>

      <!-- single dynamic message + login button -->
      <div id="msg" class="msg" style="display:none"></div>
      <a id="goto-login" class="btn-secondary" href="login.html" style="display:none">Go to login</a>
    </div>
  </section>

  <!-- Support FAB + Overlay -->
  <button id="supportFab" class="fab" aria-label="Customer Support">
    <img src="../assets/customer-support.png" alt="Support">
  </button>

  <div id="supportOverlay" class="support-overlay" aria-hidden="true">
    <div class="support-panel" role="dialog" aria-modal="true" aria-labelledby="supportTitle">
      <button id="supportClose" class="support-close" aria-label="Close">×</button>
      <h2 id="supportTitle">Customer Support</h2>
      <p>Start a chat or send us a message and our support team will get back to you shortly.</p>
      <form id="supportMiniForm" class="mini-form">
        <input type="text" name="name" placeholder="Full name" required />
        <input type="email" name="email" placeholder="Email" required />
        <textarea name="message" rows="4" placeholder="Write your message..." required></textarea>
        <button type="submit">Send</button>
      </form>
    </div>
  </div>

  <script>
    const API_BASE = "http://127.0.0.1:5000/api";
    const $msg = document.getElementById("msg");
    const $goto = document.getElementById("goto-login");

    function showMsg(text, type="info", showLogin=false) {
      $msg.textContent = text;
      $msg.className = `msg ${type}`;
      $msg.style.display = "block";
      $goto.style.display = showLogin ? "inline-block" : "none";
    }

    (function handleEmailConfirmRedirect() {
      const hash = window.location.hash.startsWith("#") ? window.location.hash.slice(1) : "";
      if (!hash) return;
      const p = new URLSearchParams(hash);
      if (p.get("error")) {
        const reason = p.get("error_description") || "Email link is invalid or expired.";
        showMsg(reason + " You can sign in or request a new email.", "error", true);
        return;
      }
      if (p.get("access_token")) {
        showMsg("Your email has been verified. Account created successfully! Redirecting to login…", "success", true);
        setTimeout(() => { window.location.href = "login.html"; }, 1500);
      }
    })();

    document.getElementById("signup-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim().toLowerCase();
      const password = document.getElementById("password").value;

      const res = await fetch(`${API_BASE}/auth/signup`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        body: JSON.stringify({ name, email, password })
      });
      const data = await res.json();

      if (res.status === 409) {
        showMsg("Your account is already registered. Please sign in.", "info", true);
        return;
      }

      if (!res.ok) {
        showMsg(data.error || "Could not create account.", "error", false);
        return;
      }

      if (data.message && /check.*email/i.test(data.message)) {
        showMsg("Check your email to confirm your account.", "info", false);
        return;
      }

      showMsg("Account created successfully!", "success", true);
    });

    // Support FAB logic
    const supportFab = document.getElementById('supportFab');
    const supportOverlay = document.getElementById('supportOverlay');
    const supportClose = document.getElementById('supportClose');
    const supportMiniForm = document.getElementById('supportMiniForm');
    function openSupport() {
      supportOverlay.classList.add('open');
      supportOverlay.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }
    function closeSupport() {
      supportOverlay.classList.remove('open');
      supportOverlay.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }
    supportFab.addEventListener('click', openSupport);
    supportClose.addEventListener('click', closeSupport);
    supportOverlay.addEventListener('click', e => { if (e.target === supportOverlay) closeSupport(); });
    supportMiniForm.addEventListener('submit', e => { e.preventDefault(); alert('Message sent (demo).'); supportMiniForm.reset(); closeSupport(); });
  </script>

  <footer>
    <div class="container foot">
      <div><a href="/LICENSE">MIT License</a> · <a href="https://github.com/your-org/your-repo" target="_blank" rel="noopener">GitHub</a></div>
      <div><a href="../index.html">Home</a> · <a href="#users">Users</a> · <a href="#contributors">Contributors</a> · <a href="./help.html">Help</a></div>
      <div>© 2025 Cruzr · University Project</div>
    </div>
  </footer>
</body>
</html>
